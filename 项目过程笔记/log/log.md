# log/log.h、log/log.cpp

## 使用库

* cstdio 头文件，包含标准 C 库标头 \<stdio.h>，并将关联的名称添加到 std 命名空间。

```C++
#include <cstdio>

// FILE 类型，标识流并包含控制流所需信息的对象类型，包括指向其缓冲区的指针、位置指示器和所有状态指示器。
FILE

// fflush 函数，将未写入内容写入文件
int fflush ( FILE * stream );
// 如果给定的流是打开写的(或者如果它是打开更新的，并且最后的i/o操作是输出操作)，它的输出缓冲区中任何未写的数据都被写入文件。如果stream是空指针，所有这样的流都将被刷新。

// fputs 函数，将由str指向的C字符串写入流。
int fputs ( const char * str, FILE * stream );
// 函数从指定的地址(str)开始复制，直到到达结束空字符('\0')。此终止空字符不会复制到流中。

```

* memory 头文件

```C++
#include <memory>

//存储指向拥有的对象或数组的指针。 此对象/数组仅由 unique_ptr 拥有。 unique_ptr 被销毁后，此对象/数组也将被销毁。
template <class T, class D = default_delete<T>> class unique_ptr;
//只允许基础指针的一个所有者。 除非你确信需要 shared_ptr，否则请将该指针用作 POCO 的默认选项。 可以移到新所有者，但不会复制或共享。 替换已弃用的 auto_ptr。 与 boost::scoped_ptr 比较。 unique_ptr 小巧高效；大小等同于一个指针且支持 rvalue 引用，从而可实现快速插入和对 C++ 标准库集合的检索。
```

* thread 头文件

```C++

// thread类的成员函数joinable()，指定关联的线程是否可联接。如果线程对象表示一个执行线程，那么它就是可联接的。
bool joinable() const noexcept;

// thread类的成员函数join()，阻塞，直到完成与调用对象相关联的执行线程。调用此函数后，线程对象变得不可连接，可以安全地销毁。
bool joinable() const noexcept;

```

## 笔记

日志类，采用单例模式，

一些带锁的方法虽然看不出有成本变量的改变，但其实锁是有在变的，所以不能加const

私有成员变量：

* kLogPathLen：常量，表示最大日志文件路径的长度为256（没有用上）
* kLogNameLen：常量，表示日志文件名的最长名字为256
* kMaxLines：常量，表示日志文件中最大行数为50000
* path_：字符串常量的指针，指向日志文件路径
* suffix_：字符串常量的指针，指向日志文件后缀名
* max_lines_：未使用
* line_count_：表示当前日志的行数
* today_：表示当前为本月第几天
* is_open_：表示日志系统是否开启
* buff_：日志内容缓冲区
* level_：日志等级，一共0，1，2，3四个等级
* is_async_：表示是否异步写入
* fp_：文件类型指针，用于对日志文件的写入
* deque_：独占指针，指向存放日志信息的阻塞队列
* write_thread_：独占指针，指向将日志信息写入文件的线程
* mtx_：互斥锁，用于日志文件的互斥写入

私有构造函数：不能直接构造，只能用静态的公有成员函数Instance获取唯一一个Log对象。只初始化一些成员变量

私有虚析构函数：因为有指针成员fp_，需要自己写虚构函数进行释放，加上virtual可能防止这个类被继承后析构出现问题？

* 如果写线程指针不为空且线程还在执行
  * 关闭阻塞队列
    * 阻塞队列不为空的话，将消费者线程唤醒使其消费完队列内容
  * 阻塞线程，使线程对象可以安全销毁
* 如果文件指针不为空
  * 上锁后，消费完队列内容，写入未写入内容，关闭文件指针

私有成员函数：

AppendLogLevelTitle_：根据日志等级，向缓冲区放入相应的日志头部信息字符串

AsyncWrite_：异步写，将阻塞队列的内容全部写入文件

公有成员函数：

init：

Instance：创建静态日志对象，获取日志对象的指针，单例模式获取对象的方法

FlushLogThread：调用异步写，将队列内容全部写入文件

Write：

Flush：将未写入文件的日志内容写入

GetLevel：获取日志等级，即获取私有成员变量日志标识，设置和获取需要上锁

SetLevel：设置日志等级，即设置私有成员变量日志标识，设置和获取需要上锁

IsOpen：判断日志是否关闭，即然后是否关闭的成员变量标识
